<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Tetris+</title>
  <link rel="stylesheet" href="../arcade.css">
  <style> 
    body { background:#000; color:#fff; text-align:center; font-family:Arial; margin:0; padding:10px }
    .wrap { display:flex; gap:16px; justify-content:center; align-items:flex-start; margin-top:10px }
    canvas {
      background:#222;       /* ✅ lighter background */
      border:2px solid #555; /* ✅ visible border */
      box-shadow:0 0 15px #000;
    }
    .panel { text-align:left }
    .stat { margin:.4em 0 }
    .next { background:#111; display:block; border:1px solid #333 }
    .btn { display:inline-block; margin-top:8px; padding:6px 10px; background:#222; color:#eee; text-decoration:none; border-radius:6px }
  </style>
</head>
<body>
  <h1>Tetris+</h1>
  <div class="wrap">
    <canvas id="tetris" width="240" height="400"></canvas>
    <div class="panel">
      <div class="stat">Score: <span id="score">0</span></div>
      <div class="stat">Level: <span id="level">1</span></div>
      <div class="stat">Lines: <span id="lines">0</span></div>
      <canvas id="next" width="80" height="80" class="next"></canvas>
      <a class="btn" href="#" onclick="restart();return false;">Restart</a>
      <div style="text-align:center;margin-top:10px">
        <a href="../index.html" class="back-btn">⟵ Back to Arcade</a>
      </div>
    </div>
  </div>
  <script>
    const canvas=document.getElementById('tetris');const ctx=canvas.getContext('2d');ctx.scale(20,20);
    const ncv=document.getElementById('next');const nctx=ncv.getContext('2d');nctx.scale(20,20);
    const scoreEl=document.getElementById('score'), levelEl=document.getElementById('level'), linesEl=document.getElementById('lines');
    const colors=[null,'#a64dff','#ffd93d','#ff8c42','#3da1ff','#45f0ff','#5bff7a','#ff5858'];

    function createMatrix(w,h){const m=[];while(h--)m.push(new Array(w).fill(0));return m;}
    function createPiece(t){return{'T':[[0,0,0],[1,1,1],[0,1,0]],'O':[[2,2],[2,2]],'L':[[0,3,0],[0,3,0],[0,3,3]],'J':[[0,4,0],[0,4,0],[4,4,0]],'I':[[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]],'S':[[0,6,6],[6,6,0],[0,0,0]],'Z':[[7,7,0],[0,7,7],[0,0,0]]}[t];}
    function drawMatrix(m,o,c=ctx){m.forEach((row,y)=>row.forEach((v,x)=>{if(v!==0){c.fillStyle=colors[v];c.fillRect(x+o.x,y+o.y,1,1);}}));}
    function merge(ar,p){p.matrix.forEach((row,y)=>row.forEach((v,x)=>{if(v!==0)ar[y+p.pos.y][x+p.pos.x]=v;}));}
    function collide(ar,p){const m=p.matrix;const o=p.pos;for(let y=0;y<m.length;++y){for(let x=0;x<m[y].length;++x){if(m[y][x]!==0&&(ar[y+o.y]&&ar[y+o.y][x+o.x])!==0)return true;}}return false;}
    function rotate(m,dir){for(let y=0;y<m.length;++y)for(let x=0;x<y;++x)[m[x][y],m[y][x]]=[m[y][x],m[x][y]];if(dir>0)m.forEach(r=>r.reverse());else m.reverse();}
    const arena=createMatrix(12,20);
    const player={pos:{x:0,y:0},matrix:null,score:0,level:1,lines:0};
    let dropCounter=0, dropInterval=1000, lastTime=0, nextPiece=null;

    function arenaSweep(){let rowCount=1;outer:for(let y=arena.length-1;y>=0;--y){for(let x=0;x<arena[y].length;++x){if(arena[y][x]===0)continue outer;}const row=arena.splice(y,1)[0].fill(0);arena.unshift(row);++y;player.score+=rowCount*100;player.lines+=1;rowCount*=2;if(player.lines%10===0){player.level++;dropInterval=Math.max(120,1000-(player.level-1)*100);}}}
    function playerReset(){const pieces='TJLOSZI';player.matrix=createPiece(nextPiece||pieces[(Math.random()*pieces.length)|0]);player.pos.y=0;player.pos.x=(arena[0].length/2|0)-(player.matrix[0].length/2|0);nextPiece=pieces[(Math.random()*pieces.length)|0];drawNext();if(collide(arena,player)){arena.forEach(r=>r.fill(0));player.score=0;player.level=1;player.lines=0;dropInterval=1000;}updateHUD();}
    function drawNext(){nctx.fillStyle='#000';nctx.fillRect(0,0,ncv.width,ncv.height);drawMatrix(createPiece(nextPiece),{x:1,y:1},nctx);}
    function updateHUD(){scoreEl.textContent=player.score;levelEl.textContent=player.level;linesEl.textContent=player.lines;}
    function playerDrop(){player.pos.y++;if(collide(arena,player)){player.pos.y--;merge(arena,player);arenaSweep();playerReset();}dropCounter=0;}
    function playerMove(dir){player.pos.x+=dir;if(collide(arena,player))player.pos.x-=dir;}
    function playerRotate(d){const pos=player.pos.x;let offset=1;rotate(player.matrix,d);while(collide(arena,player)){player.pos.x+=offset;offset=-(offset+(offset>0?1:-1));if(offset>player.matrix[0].length){rotate(player.matrix,-d);player.pos.x=pos;return;}}}
    function draw(){ctx.fillStyle='#000';ctx.fillRect(0,0,canvas.width,canvas.height);drawMatrix(arena,{x:0,y:0});drawMatrix(player.matrix,player.pos);}
    function update(t=0){const dt=t-lastTime;lastTime=t;dropCounter+=dt;if(dropCounter>dropInterval)playerDrop();draw();requestAnimationFrame(update);}
    function restart(){arena.forEach(r=>r.fill(0));player.score=0;player.level=1;player.lines=0;dropInterval=1000;playerReset();}
    document.addEventListener('keydown',e=>{if(e.key==='ArrowLeft')playerMove(-1);else if(e.key==='ArrowRight')playerMove(1);else if(e.key==='ArrowDown')playerDrop();else if(e.key==='q'||e.key==='Q')playerRotate(-1);else if(e.key==='w'||e.key==='W')playerRotate(1);});
    playerReset();update();
  </script>
</body>
</html>
